<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- MAIN STORE STYLE -->
  <link rel="stylesheet" href="css/store.css">
</head>
<body>

<!-- ================= TOP HEADER ================= -->
<header class="topbar">
  <button class="hamburger" onclick="toggleSidebar()">â˜°</button>

  <h1 class="brand" onclick="location.href='index.html'">
    Sellfix Designing
  </h1>

  <div class="right">
    <!-- CART ICON -->
    <button class="cart-icon" onclick="goCart()">
      ğŸ›’
      <span id="cartCount" class="cart-count">0</span>
    </button>

    <!-- LOGIN / LOGOUT -->
    <button class="auth-btn" id="authBtn"></button>
  </div>
</header>

<!-- ================= BACK BAR ================= -->
<div class="top-bar custom-topbar">
  <span class="back-btn" onclick="goBack()">â† Back</span>
</div>

<!-- ================= PRODUCT PAGE ================= -->
<main class="product-page">

  <!-- IMAGE SLIDER -->
  <div id="slider" class="slider"></div>
  <div id="sliderDots" class="slider-dots"></div>

  <!-- PRODUCT DETAILS -->
  <div id="productDetails" class="product-details"></div>

</main>

<!-- ================= BOTTOM ACTIONS ================= -->
<div class="bottom-actions">
  <button class="buy-btn" onclick="buyNow()">Buy Now</button>
  <button
    id="primaryActionBtn"
    class="primary-btn"
    onclick="handlePrimaryAction()">
    Loading...
  </button>
</div>

<!-- ================= SHARE ================= -->
<div id="shareBtn" onclick="sharePage()">ğŸ”—</div>

<!-- ================= SIDEBAR ================= -->
<div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

<aside id="sidebar" class="sidebar">
  <div class="sidebar-header">
    <div id="sidebarUser">User</div>
  </div>

  <ul class="sidebar-menu">
    <li onclick="location.href='index.html'">ğŸ› Shop</li>
    <li onclick="goCart()">ğŸ›’ Cart</li>
    <li onclick="location.href='wishlist.html'">â¤ï¸ Wishlist</li>
    <li onclick="location.href='my-orders.html'">ğŸ“¦ My Orders</li>
    <li onclick="location.href='addresses.html'">ğŸ  Saved Addresses</li>
    <li id="sidebarAuthBtn" onclick="handleAuth()">Login</li>
  </ul>
</aside>

<!-- ================= SCRIPTS ================= -->

<!-- LOGIN GUARD -->
<script src="js/customer-guard.js"></script>

<!-- SIDEBAR + AUTH -->
<script type="module" src="js/sidebar.js"></script>

<!-- CART COUNT + AUTH BTN -->
<script type="module" src="js/store.js"></script>

<!-- PRODUCT PAGE LOGIC -->
<script type="module" src="js/product.js"></script>

<script>
  /* ================= BACK ================= */
  function goBack() {
    if (history.length > 1) {
      history.back();
    } else {
      location.href = "index.html";
    }
  }

  /* ================= AUTH BUTTON ================= */
  function initAuthButton() {
    const uid = localStorage.getItem("customerUid");
    const authBtn = document.getElementById("authBtn");

    if (!authBtn) return;

    if (uid) {
      authBtn.innerText = "Logout";
      authBtn.onclick = () => {
        localStorage.clear();
        location.reload();
      };
    } else {
      authBtn.innerText = "Login";
      authBtn.onclick = () => {
        localStorage.setItem("redirectAfterLogin", location.href);
        location.href = "login.html";
      };
    }
  }

  /* ================= CART COUNT ================= */
  function updateCartCountSafe() {
    const el = document.getElementById("cartCount");
    if (!el) return;

    const uid = localStorage.getItem("customerUid");
    if (!uid) {
      el.innerText = "0";
      return;
    }

    const cart = JSON.parse(localStorage.getItem(`cart_${uid}`)) || { items: [] };
    const count = cart.items.reduce((s, i) => s + (i.qty || 1), 0);
    el.innerText = count;
  }

  document.addEventListener("DOMContentLoaded", () => {
    initAuthButton();
    updateCartCountSafe();
  });
</script>

</body>
</html>